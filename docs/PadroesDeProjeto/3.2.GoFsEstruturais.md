# 3.2. GoFs Estruturais

## Sum√°rio
- [3.2. GoFs Estruturais](#32-gofs-estruturais)
  - [Sum√°rio](#sum√°rio)
  - [Metodologia](#metodologia)
  - [Diagrama antes e depois](#diagrama-antes-e-depois)
    - [Adapter](#adapter)
    - [Facade](#facade)
  - [C√≥digo](#c√≥digo)
  - [C√≥digo rodando](#c√≥digo-rodando)
    - [Facade](#facade-1)
    - [Adapter](#adapter-1)
  - [Conclus√£o](#conclus√£o)
  - [Refer√™ncias](#refer√™ncias)
  - [Hist√≥rico de Vers√µes](#hist√≥rico-de-vers√µes)

---
## Metodologia
Com base nos requisitos levantados e nas funcionalidades implementadas, foram analisados os padr√µes de projeto GoF estruturais, com o objetivo de identificar sua aplicabilidade pr√°tica na arquitetura da aplica√ß√£o ([**Ata Reuni√£o [27/05]**](https://unbbr-my.sharepoint.com/:w:/g/personal/211062947_aluno_unb_br/EYgCQ6DBuxxGpyXkuWrLLSwBZ922m-fQ1p4DgNH41q6s8A?e=aWe77D)). A partir dessa an√°lise, foram adotados os seguintes padr√µes, conforme descrito e justificado a seguir:

- Adapter: Utilizado na Media API, o padr√£o Adapter foi empregado para permitir a convers√£o dos arquivos de m√≠dia armazenados no backend em formatos compat√≠veis com o frontend. Inicialmente armazenados como arquivos bin√°rios, esses dados s√£o convertidos em objetos [**"Blob"**](https://developer.mozilla.org/en-US/docs/Web/API/Blob)  possibilitando seu uso direto na interface da aplica√ß√£o. Essa adapta√ß√£o ocorre sem modificar a l√≥gica principal de leitura dos arquivos, promovendo desacoplamento e reutiliza√ß√£o de c√≥digo.
  - [**Implementa√ß√£o - Adapter**](https://github.com/UnBArqDsw2025-1-Turma01/2025.1-T01-_G7_FCTEPodcast/blob/main/fctepodcast-backend/src/adapter/ImageAdapter.ts)

- Facade: O padr√£o Facade foi aplicado no controle de acesso para fornecer uma interface simples e unificada para um subsistema complexo de autentica√ß√£o e autoriza√ß√£o. Ele abstrai a l√≥gica de cria√ß√£o e valida√ß√£o de tokens JWT e a verifica√ß√£o de permiss√µes, facilitando o uso desses servi√ßos por outras partes da aplica√ß√£o.
  - [**Implementa√ß√£o - Facade**](https://github.com/UnBArqDsw2025-1-Turma01/2025.1-T01-_G7_FCTEPodcast/blob/main/fctepodcast-backend/src/facade/AuthFacade.ts)
  - [**Implementa√ß√£o - JWTService**](https://github.com/UnBArqDsw2025-1-Turma01/2025.1-T01-_G7_FCTEPodcast/blob/main/fctepodcast-backend/src/services/JWTService.ts)

## Diagrama antes e depois
### Adapter
![Diagrama do Adapter](./_media/adapter.png)

### Facade
![Diagrama do Facade](./_media/facade.png)

## C√≥digo
imagens do adapter

![ArchiveAdapter](_media/Adapter/Adapter/ArchiveAdapter.png)

Este c√≥digo implementa o padr√£o de projeto Adapter, que √© um dos padr√µes estruturais do GoF. O adaptador implementa a interface ArchiveProvider e utiliza internamente uma inst√¢ncia da classe ArchiveFileSystem.

Ele adapta a interface esperada pelo cliente, que √© o m√©todo getImage(imagePath, res), para interagir com o sistema de arquivos, verificando se a imagem solicitada existe. Se a imagem existir, o adaptador envia o arquivo como resposta HTTP. Caso contr√°rio, retorna um erro 404.

Al√©m disso, ele trata poss√≠veis erros durante o processo e responde com mensagens JSON apropriadas ao cliente, o que √© comum em APIs REST.

Este adaptador est√° inserido em um contexto real e pr√°tico de web backend, com uso de Express e HTTP. Portanto, al√©m de adaptar uma interface, ele tamb√©m adapta o tratamento de erros para respostas JSON, cumprindo o papel esperado de um adaptador no mundo real.

![ArchiveFileSystem](_media/Adapter/Adapter/ArchiveFileSystem.png)

Esta classe implementa um sistema de arquivos para gerenciar imagens.
Ela √© respons√°vel por organizar o local onde as imagens s√£o armazenadas e fornecer m√©todos para obter o caminho completo de uma imagem, verificar se a imagem existe e envi√°-la como resposta HTTP ap√≥s a convers√£o para um Blob.

![ArchiveProvider](_media/Adapter/Adapter/ArchiveProvider.png)

Esta interface define os m√©todos que um provedor de arquivos de imagem deve implementar.
Ela permite que o sistema funcione com diferentes implementa√ß√µes de provedores, garantindo que todos sigam um contrato comum para obter imagens.
O m√©todo getImage recebe o caminho da imagem e o objeto de resposta HTTP para enviar a imagem de volta ao cliente.

Imagens Do Facade

![AuthFacade](_media/Facade/Facade/AuthFacade.png)

Este c√≥digo implementa o padr√£o de projeto Facade, encapsulando a l√≥gica de autentica√ß√£o e autoriza√ß√£o em uma interface simplificada chamada AuthFacade.

O objetivo da fachada √© fornecer uma maneira simples de lidar com requisi√ß√µes seguras, escondendo os detalhes de como o token √© validado e como o usu√°rio √© obtido. A fachada serve como uma interface √∫nica para um conjunto complexo de classes.

O principal m√©todo exposto √© o handleSecureRequest, que recebe uma lista de pap√©is (roles) permitidos e um handler que ser√° executado apenas se a requisi√ß√£o for autenticada e autorizada corretamente.

A JWTService √© respons√°vel por extrair e validar o token JWT da requisi√ß√£o. J√° o UsuarioController busca o usu√°rio correspondente ao token. O m√©todo verifica a exist√™ncia do token, sua validade, a exist√™ncia do usu√°rio, e se o papel do usu√°rio est√° entre os permitidos.

Al√©m disso, a fachada se adapta ao uso com o framework Express atrav√©s de middlewares, permitindo integra√ß√£o com rotas seguras. Tamb√©m permite a inje√ß√£o de depend√™ncias com fallback para inst√¢ncias padr√£o, o que facilita testes com mocks e promove o desacoplamento entre classes.

![JWTService](_media/Facade/Facade/JWTService.png)

Este servi√ßo √© respons√°vel por lidar com a autentica√ß√£o baseada em JWT (JSON Web Tokens). Ele extrai o token do cookie da requisi√ß√£o e valida o token usando uma chave secreta. Tamb√©m lida com erros de valida√ß√£o, retornando null se o token for inv√°lido. √â usado pelo AuthFacade para proteger rotas e garantir que apenas usu√°rios autenticados possam acessar recursos protegidos.


## C√≥digo rodando

### Facade

A seguir, apresentamos uma demonstra√ß√£o da aplica√ß√£o do padr√£o Facade, onde utilizamos um token de aluno para tentar criar um podcast. Devido √† aus√™ncia de permiss√µes adequadas, o sistema intercepta a requisi√ß√£o e retorna um erro, evidenciando o controle de acesso realizado com sucesso.

<iframe width="560" height="315" src="https://www.youtube.com/embed/kuaR6sFeMVE?si=_7-VWDi2sJYBSDVM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

Tamb√©m demonstramos, conforme mencionado anteriormente no t√≥pico sobre o padr√£o [**GoF Criacional - Builder**](/PadroesDeProjeto/3.1.GoFsCriacionais.md?id=metodologia), a integra√ß√£o j√° implementada com o AuthFacade, respons√°vel por centralizar e gerenciar a l√≥gica de autentica√ß√£o e autoriza√ß√£o dos usu√°rios.

<iframe width="560" height="315" src="https://www.youtube.com/embed/naaPv6M2Ok4?si=I-B56bqxah425S_2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

### Adapter

A demonstra√ß√£o a seguir apresenta a implementa√ß√£o do padr√£o de projeto Adapter, utilizada para converter imagens em objetos do tipo Blob na API. Essa adapta√ß√£o permite que os dados sejam transmitidos de forma compat√≠vel com o cliente, possibilitando a correta exibi√ß√£o das imagens na interface da aplica√ß√£o.

<iframe width="560" height="315" src="https://www.youtube.com/embed/IavOaWlG9uc?si=TX4MtuLMerv9SLtF" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>



## Conclus√£o

A aplica√ß√£o pr√°tica dos padr√µes de projeto estruturais da GoF, especificamente Adapter e Facade, demonstrou-se essencial para aprimorar a modularidade, reutiliza√ß√£o e manutenibilidade da arquitetura do FCTEPodcast. O uso do padr√£o Adapter ajudou a garantir um maior desacoplamento entre as camadas do sistema. J√° o padr√£o Facade contribuiu significativamente para a simplifica√ß√£o do processo de autentica√ß√£o e autoriza√ß√£o, unificando e abstraindo opera√ß√µes complexas em uma interface clara e de f√°cil integra√ß√£o com as rotas protegidas da aplica√ß√£o.

Al√©m de facilitar a compreens√£o e manuten√ß√£o do c√≥digo, esses padr√µes promoveram a separa√ß√£o de responsabilidades e possibilitaram maior flexibilidade para futuras altera√ß√µes ou substitui√ß√µes de componentes. Ademais, a documenta√ß√£o, os diagramas e os trechos de c√≥digo apresentados refor√ßam a import√¢ncia da utiliza√ß√£o consciente dos padr√µes de projeto.

## Refer√™ncias

### üîß Padr√µes Estruturais

- [Refactoring Guru ‚Äì Design Patterns: Padr√µes Estruturais](https://refactoring.guru/design-patterns/creational-patterns)  

- [Refactoring Guru ‚Äì Facade Pattern](https://refactoring.guru/design-patterns/adapter)  

- [Refactoring Guru ‚Äì Adapter Pattern](https://refactoring.guru/design-patterns/facade)  

### üéì Material da Professora

- [Material de Apoio - UNB Moodle](https://aprender3.unb.br/mod/page/view.php?id=1372235)  
  P√°gina com material complementar utilizado em sala de aula sobre padr√µes de projeto.

--- 

## Hist√≥rico de Vers√µes

| Vers√£o |    Data    |        Descri√ß√£o         |    Autor(es)    |  Revisor(es)     |  Detalhes da Revis√£o  |  
| :----: | :--------: | :----------------------: | :-------------: | :----------------| :---------------------|
|  1.0   | 31/05/2025 |   Cria√ß√£o do documento   | Nat√°lia Rodrigues | Harleny A. | Arquiteura de pastas revisada |
|  1.1   | 31/05/2025 |   Adi√ß√£o de C√≥digos em imagens   | Gustavo C., Harleny A., Iderlan J., Rafael K. | Gustavo Costa de Jesus | Verifica√ß√£o de inser√ß√£o de imagens|
| 1.2    | 01/06/2025 | Adi√ß√£o da Metodologia | Gustavo Costa | 
| 1.3    | 01/06/2025 | Explica√ß√£o dos c√≥digos | Nat√°lia Rodrigues | 
| 1.4    | 01/06/2025 | Adicionando diagramas | Rafael Kenji |
| 1.5    | 01/06/2025 | Adicionando conclus√£o | Marcella Anderle | 
| 1.6  | 01/06/2025  | Adi√ß√£o de V√≠deos de demonstra√ß√£o | Gustavo C., Rafael K., Iderlan J., Marcella Anderle, Harleny A. |
| 1.7 | 01/06/2025  | Revis√£o dos textos | Nat√°lia Rodrigues, Gustavo Costa, Marcella Anderle |   Gustavo C., Rafael K., Iderlan J., Marcella Anderle, Harleny A. |  Revis√£o de todos os textos        |  
|1.8|	02/06/2025	|Adi√ß√£o de Refer√™ncias| Harleny Ang√©llica|	Gustavo Costa|Texto Revisado |